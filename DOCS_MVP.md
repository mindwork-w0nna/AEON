# AEON - MVP Implementation Documentation

## Обзор

AEON - это пиксельный рогалик с асимметричным кооперативом и механикой предательства. Два игрока существуют в двух версиях одного и того же данжа, и их действия взаимно влияют друг на друга.

## Реализованные системы

### 1. Иерархический Grid System

**Компоненты:**
- `GridCell.cs` - базовая ячейка грида (подклетка)
- `GridChunk.cs` - чанк размером 8×8 ячеек
- `GridManager.cs` - менеджер всей сетки

**Особенности:**
- Каждая ячейка хранит состояние для обоих миров (Light/Shadow)
- Чанки агрегируют данные о повреждениях и искажениях
- Система регистрации ударов на уровне ячеек и чанков

### 2. Система двух миров

**Компоненты:**
- `WorldType.cs` - enum для типов миров
- `TileState.cs` - состояние тайла в каждом мире
- `WorldManager.cs` - управление мирами и визуализацией

**Особенности:**
- Светлый и Теневой миры на одном гриде
- Разные типы тайлов для каждого мира
- Переключение между мирами (клавиша T)

### 3. Hit Registry System

**Компоненты:**
- `HitRegistry.cs` - система регистрации ударов

**Механика:**
- Каждый удар Сталкера по окружению записывается
- При достижении порогов (5, 15, 30 ударов) изменяется Теневой мир
- Порог 1: появляется трещина (ShadowCrack)
- Порог 2: опасная зона (DangerZone)
- Порог 3: теневое ядро (ShadowCore)

### 4. Система игроков

#### Сталкер (Light World)
**Компоненты:**
- `PlayerBase.cs` - базовый класс
- `StalkerPlayer.cs` - реализация Сталкера

**Управление:**
- WASD/Arrows - передвижение
- Space - атака (регистрирует удар в HitRegistry)
- E - взаимодействие

**Механики:**
- Физический бой с окружением
- Каждая атака влияет на Теневой мир
- Может взаимодействовать с объектами

#### Теневой (Shadow World)
**Компоненты:**
- `ShadowPlayer.cs` - реализация Теневого

**Управление:**
- WASD/Arrows - передвижение
- Q - стабилизировать ячейку (стоит 20 энергии)
- E - коррумпировать ячейку (стоит 30 энергии)
- Tab - показать информацию об искажениях

**Механики:**
- Теневая энергия (100 макс, регенерация 5/сек)
- Стабилизация уменьшает опасность для Сталкера
- Коррупция увеличивает опасность для Сталкера

### 5. Система взаимного влияния

**Компоненты:**
- `WorldInfluenceSystem.cs` - обработка взаимного влияния миров

**Механики:**
- Автоматическое распространение искажений
- Чанки с высоким уровнем искажения влияют на соседние области
- Периодическая обработка влияния (раз в секунду)

### 6. Система предательства

**Компоненты:**
- `BetrayalSystem.cs` - учет предательств
- `SharedChest.cs` - общий сундук (тактическое предательство)
- `ShadowNode.cs` - теневой узел (тактическое предательство)

#### Для Сталкера:
**SharedChest:**
- F - взаимодействовать с сундуком
- 1 - поделиться честно (оба получают награду)
- 2 - забрать всё (ПРЕДАТЕЛЬСТВО - больше лута, но метка предателя)

#### Для Теневого:
**ShadowNode:**
- R - взаимодействовать с узлом
- 1 - стабилизировать область (помочь напарнику)
- 2 - коррумпировать область (ПРЕДАТЕЛЬСТВО - осложнить жизнь напарнику)

**Последствия:**
- Система отслеживает счет предательств
- При достижении порога (3.0) игрок получает статус "предатель"
- В будущих ранах будет больше сложностей

### 7. Дополнительные системы

**Компоненты:**
- `GameManager.cs` - основной менеджер игры
- `CameraController.cs` - управление камерой

## Управление

### Общие клавиши:
- G - сгенерировать тестовый уровень
- T - переключить вид мира (Light/Shadow)
- Esc - выход

### Сталкер:
- WASD/Arrows - движение
- Space - атака
- E - взаимодействие
- F - взаимодействие с сундуком

### Теневой:
- WASD/Arrows - движение
- Q - стабилизировать (20 энергии)
- E - коррумпировать (30 энергии)
- Tab - информация об искажениях
- R - взаимодействие с теневым узлом

## Архитектура кода

```
Assets/Scripts/
├── Core/
│   ├── WorldType.cs          - Enum типов миров
│   ├── TileType.cs           - Enum типов тайлов
│   ├── TileState.cs          - Состояние тайла
│   ├── GridCell.cs           - Ячейка грида
│   ├── GridChunk.cs          - Чанк 8×8
│   ├── GridManager.cs        - Менеджер грида
│   ├── GameManager.cs        - Основной менеджер
│   └── CameraController.cs   - Управление камерой
│
├── World/
│   ├── WorldManager.cs               - Менеджер миров
│   ├── HitRegistry.cs                - Регистрация ударов
│   └── WorldInfluenceSystem.cs       - Взаимное влияние
│
├── Player/
│   ├── PlayerBase.cs         - Базовый класс игрока
│   ├── StalkerPlayer.cs      - Сталкер
│   └── ShadowPlayer.cs       - Теневой
│
└── Betrayal/
    ├── BetrayalSystem.cs     - Система предательства
    ├── SharedChest.cs        - Общий сундук
    └── ShadowNode.cs         - Теневой узел
```

## Настройка сцены в Unity

### Базовая настройка:

1. Создать пустой GameObject "GameSystems":
   - Добавить `GameManager`
   - Добавить `GridManager`
   - Добавить `BetrayalSystem`

2. Создать GameObject "WorldSystems":
   - Добавить `WorldManager`
   - Добавить `HitRegistry`
   - Добавить `WorldInfluenceSystem`
   - Настроить ссылки на Tilemaps

3. Создать Tilemaps:
   - Создать Grid
   - Добавить два Tilemap: "LightWorld" и "ShadowWorld"
   - Назначить их в WorldManager

4. Создать игроков:
   - Создать GameObject "Stalker" с компонентом `StalkerPlayer`
   - Добавить Rigidbody2D (Gravity Scale = 0)
   - Создать GameObject "ShadowPlayer" с компонентом `ShadowPlayer`
   - Добавить Rigidbody2D (Gravity Scale = 0)

5. Настроить камеру:
   - Добавить `CameraController` на Main Camera
   - Назначить target (Stalker или Shadow)

## Следующие шаги (не входят в MVP)

1. Визуализация
   - Спрайты для тайлов
   - Анимации игроков
   - Визуальные эффекты искажений
   - UI для отображения здоровья, энергии, счета предательств

2. Враги и боевая система
   - Базовые враги для Светлого мира
   - Призраки для Теневого мира
   - Система спавна врагов

3. Генерация уровней
   - Процедурная генерация данжей
   - Разные типы комнат
   - Биомы

4. Сетевой мультиплеер
   - Синхронизация состояния
   - Сетевая передача действий
   - Lobby система

5. Расширенная механика предательства
   - Больше способов предательства
   - Мета-прогрессия с меткой предателя
   - Особый контент для предателей

## Технические детали

### Производительность:
- Grid разбит на чанки для оптимизации
- Обновление влияния происходит раз в секунду, а не каждый кадр
- Gizmos для отладки отображаются только в редакторе

### Расширяемость:
- Использование enum для типов позволяет легко добавлять новые
- Система событий для предательства
- Паттерн Singleton для менеджеров (можно заменить на DI)

## Тестирование MVP

1. Запустить сцену
2. Нажать G для генерации тестового уровня
3. Управлять Сталкером (WASD + Space)
4. Нажать T для переключения на вид Теневого мира
5. Наблюдать как удары Сталкера создают искажения в Теневом мире
6. Управлять Теневым (Q/E) для влияния на Светлый мир

## Известные ограничения MVP

1. Нет визуальных ассетов (используются базовые тайлы)
2. Нет настоящего мультиплеера (можно переключаться между игроками)
3. Нет врагов и боевой системы с NPC
4. Нет процедурной генерации (только тестовый уровень)
5. Базовый UI в консоли
6. Нет сохранения прогресса

## Заключение

Данный MVP реализует все ключевые механики концепта:
- ✅ Иерархический грид с чанками 8×8
- ✅ Два мира на одном гриде
- ✅ Система регистрации ударов
- ✅ Две роли с разными механиками
- ✅ Взаимное влияние миров
- ✅ Базовая механика предательства

MVP готов для дальнейшего расширения и добавления контента.
